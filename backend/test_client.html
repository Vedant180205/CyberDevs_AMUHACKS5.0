<!DOCTYPE html>
<html>
<head>
  <title>CampusIQ API Test</title>
  <style>
    body {
      font-family: Arial;
      padding: 20px;
      max-width: 800px;
      margin: auto;
    }
    input, button, textarea {
      width: 100%;
      padding: 10px;
      margin-top: 10px;
      font-size: 15px;
    }
    button {
      cursor: pointer;
      font-weight: bold;
    }
    pre {
      background: #f4f4f4;
      padding: 15px;
      border-radius: 8px;
      overflow-x: auto;
    }
  </style>
</head>
<body>

  <h1>CampusIQ Backend Test Client</h1>

  <h2>1. Login</h2>
  <input id="email" placeholder="Email" value="vedant@gmail.com">
  <input id="password" placeholder="Password" value="12345" type="password">
  <button onclick="login()">Login</button>

  <h2>Token</h2>
  <textarea id="token" rows="3" placeholder="JWT Token will appear here"></textarea>

  <h2>2. Get Profile</h2>
  <button onclick="getProfile()">Get My Profile</button>
  <button onclick="analyzeGithub()">Analyze GitHub</button>

  <hr />

<h2>4. Calculate PRS</h2>
<button onclick="calculatePRS()">Calculate PRS</button>
<pre id="prsOutput"></pre>

<h2>5. Company Lens Mode</h2>
<button onclick="companyMatch()">Company Match</button>
<pre id="companyOutput"></pre>


  <h2>3. Update Profile</h2>
  <textarea id="updateData" rows="8">
{
  "cgpa": 8.2,
  "skills": ["Python", "FastAPI", "MongoDB"],
  "github_url": "https://github.com/yourusername",
  "linkedin_url": "https://linkedin.com/in/yourprofile"
}
  </textarea>
  <button onclick="updateProfile()">Update Profile</button>

  <h2>Output</h2>
  <pre id="output"></pre>

<script>
    const BASE_URL = "http://127.0.0.1:8000";
  const API_BASE = "http://127.0.0.1:8000";

  function setOutput(data) {
    document.getElementById("output").textContent = JSON.stringify(data, null, 2);
  }

  async function login() {
    const email = document.getElementById("email").value;
    const password = document.getElementById("password").value;

    const res = await fetch(`${API_BASE}/api/auth/login`, {
      method: "POST",
      headers: {
        "Content-Type": "application/json"
      },
      body: JSON.stringify({ email, password })
    });

    const data = await res.json();

    if (data.access_token) {
      document.getElementById("token").value = data.access_token;
    }

    setOutput(data);
  }

  async function getProfile() {
    const token = document.getElementById("token").value;

    const res = await fetch(`${API_BASE}/api/student/me`, {
      method: "GET",
      headers: {
        "Authorization": `Bearer ${token}`
      }
    });

    const data = await res.json();
    setOutput(data);
  }

  async function updateProfile() {
    const token = document.getElementById("token").value;
    const updateText = document.getElementById("updateData").value;

    let updateJson;
    try {
      updateJson = JSON.parse(updateText);
    } catch (err) {
      setOutput({ error: "Invalid JSON in update box" });
      return;
    }

    const res = await fetch(`${API_BASE}/api/student/update`, {
      method: "PUT",
      headers: {
        "Content-Type": "application/json",
        "Authorization": `Bearer ${token}`
      },
      body: JSON.stringify(updateJson)
    });

    const data = await res.json();
    setOutput(data);
  }

  async function analyzeGithub() {
  const token = document.getElementById("token").value;

  const res = await fetch(`${API_BASE}/api/student/analyze/github`, {
    method: "POST",
    headers: {
      "Authorization": `Bearer ${token}`
    }
  });

  const data = await res.json();
  setOutput(data);
}

async function calculatePRS() {
  const token = document.getElementById("token").value;

  if (!token) {
    alert("Login first!");
    return;
  }

  const res = await fetch(`${API_BASE}/api/student/calculate-prs`, {
    method: "POST",
    headers: {
      "Authorization": `Bearer ${token}`
    }
  });

  const data = await res.json();

  document.getElementById("prsOutput").textContent =
    JSON.stringify(data, null, 2);
}
async function companyMatch() {
  const token = document.getElementById("token").value;

  if (!token) {
    alert("Login first!");
    return;
  }

  const res = await fetch(`${API_BASE}/api/student/company-match`, {
    method: "GET",
    headers: {
      "Authorization": "Bearer " + token
    }
  });

  const data = await res.json();

  document.getElementById("companyOutput").textContent =
    JSON.stringify(data, null, 2);
}


</script>

</body>
</html>
